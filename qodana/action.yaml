name: 'Qodana'

description: 'Action for running Qodana'

inputs:
  cache-default-branch-only:
    default: true
    description: 'Cache only default branch'
    required: true
    type: boolean
  upload-result:
    default: false
    description: 'Upload Qodana results'
    required: true
    type: boolean

runs:
  using: "composite"

  steps:
    - name: ğŸ§ªâ˜ï¸ Run Qodana Cloud
      if: ${{ startsWith(env.QODANA_TOKEN, 'ey') }}
      shell: bash
      run: echo "Qodana Cloud enabled"

    - name: ğŸ§ª Run Qodana locally
      if: ${{ !startsWith(env.QODANA_TOKEN, 'ey') }}
      shell: bash
      run: echo "Qodana is running only locally"

    - name: ğŸ’‰ğŸ§ªâ˜ï¸ Code quality with Qodana Cloud
      uses: JetBrains/qodana-action@42dad391966aca8ca344ca2340a7f43a5507e9b2 # v2025.3.1
      with:
        cache-default-branch-only: ${{ inputs.cache-default-branch-only == true }}
        upload-result: ${{ inputs.upload-result == true }}

    - name: â¤´ï¸ğŸ§ª Upload Qodana results to GitHub
      uses: JavierSegoviaCordoba/actions/github/upload/sarif@main
      with:
        sarif_file: ${{ runner.temp }}/qodana/results/qodana.sarif.json
